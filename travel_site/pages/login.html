<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>登录 - 心途旅行</title>
	<link rel="stylesheet" href="../assets/styles.css">
</head>
<body data-page="login">
	<header class="site-header">
		<div class="container header-inner">
			<a href="../../index.html" class="logo">心途旅行</a>
			<nav class="nav" aria-label="主导航">
				<button class="nav-toggle" id="navToggle" aria-expanded="false" aria-controls="navMenu" aria-label="打开菜单">
					<span class="bar"></span><span class="bar"></span><span class="bar"></span>
				</button>
				<ul id="navMenu" class="nav-menu">
					<li><a href="../destinations/destinations.html">目的地</a></li>
					<li><a href="deals.html">特惠套餐</a></li>
					<li><a href="stories.html">旅行故事</a></li>
					<li><a href="about.html">关于我们</a></li>
					<li><a href="contact.html">联系我们</a></li>
					<li><a href="favorites.html">收藏</a></li>
					<li><a href="orders.html">订单</a></li>
					<li><a href="profile.html" id="profileLink" style="display:none">个人中心</a></li>
					<li><a href="login.html" id="authLink">登录</a></li>
				</ul>
			</nav>
		</div>
	</header>

	<main class="section auth-wrap">
		<div class="auth-card">
			<h2>用户登录</h2>
			<form id="loginForm" class="auth-form" novalidate>
				<div class="form-row">
					<label class="sr-only" for="email">邮箱</label>
					<input id="email" type="text" placeholder="邮箱" required>
				</div>
				<div class="form-row">
					<label class="sr-only" for="password">密码</label>
					<input id="password" type="password" placeholder="密码" required>
				</div>
				<button type="button" onclick="login()">登录</button>
				<div class="helper"><a href="register.html">还没有账号？去注册</a></div>
				<p class="form-msg" id="loginMsg"></p>
			</form>
		</div>
	</main>

	<footer class="site-footer">
		<div class="container bottom">
			<p>© <span id="year"></span> 心途旅行</p>
		</div>
	</footer>

	<script>
		function login() {
			const email = document.getElementById("email").value.trim();
			const password = document.getElementById("password").value.trim();

			if (!email || !password) {
				alert("请填写完整信息！");
				return;
			}

			const userData = JSON.parse(localStorage.getItem(email));

			if (!userData) {
				alert("用户不存在，请先注册！");
				return;
			}

			if (userData.password === password) {
				alert("登录成功！");
				// 保存登录状态
				sessionStorage.setItem('currentUser', JSON.stringify(userData));
				localStorage.setItem('current_user', JSON.stringify(userData));
				
				// 更新导航栏状态
				if (typeof updateAuthLink === 'function') {
					updateAuthLink();
				}
				
				// 检查是否有返回URL
				const backUrl = sessionStorage.getItem('back_url');
				if (backUrl) {
					// 如果有返回URL，跳转回原页面
					sessionStorage.removeItem('back_url');
					window.location.href = backUrl;
				} else {
					// 否则跳转首页
					window.location.href = "../../index.html";
				}
			} else {
				alert("密码错误！");
			}
		}
	</script>
	<script src="../assets/script.js"></script>
</body>
</html>


